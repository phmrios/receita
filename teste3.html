<!doctype html>
<html lang="pt-BR">
  <head>
    <link rel="stylesheet" href="style.css" />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>CAD Pediátrica — Ficha ASCII</title>

    <style>

      label {
        display: block;
        margin-top: 1rem;
        font-weight: 700;
      }



      output {
        display: block;
        margin-top: 1.5rem;
        padding: 1rem;
        border: 2px solid var(--border);
        border-radius: 4px;
        background: #f9f9f9;
        color: #000;
        white-space: pre-wrap;
      }

      hr {
        margin: 2rem 0;
      }
    </style>
  </head>

  <body>
    <nav class="navbar">
      <ul>
        <li><a href="index.html">Início</a></li>
        <li><a href="teste3.html" class="active">CAD</a></li>
        <li><a href="pals.html">Ficha PALS</a></li>
      </ul>
    </nav>

    <h1>Calculadora — CAD Pediátrica (ASCII)</h1>

    <form id="calcForm">
      <label for="weight">Peso (kg)</label>
      <input
        id="weight"
        name="weight"
        type="number"
        min="1"
        step="0.1"
        required
        aria-required="true"
      />

      <label for="ageYears">Idade (anos)</label>
      <input
        id="ageYears"
        name="ageYears"
        type="number"
        min="0"
        step="1"
        placeholder="opcional"
      />

      <label for="shock">Choque?</label>
      <select id="shock" name="shock" aria-required="true">
        <option value="no">Não</option>
        <option value="yes">Sim</option>
      </select>

      <label for="dehydration">Déficit estimado</label>
      <select id="dehydration" name="dehydration" aria-required="true">
        <option value="5">5%</option>
        <option value="7" selected>7% (padrão)</option>
        <option value="10">10%</option>
      </select>

      <label for="initialRate">Volume inicial (1ª hora, mL/kg)</label>
      <select id="initialRate" name="initialRate" aria-required="true">
        <option value="10">10 mL/kg</option>
        <option value="15" selected>15 mL/kg (padrão)</option>
        <option value="20">20 mL/kg</option>
      </select>

      <button type="button" id="calcButton">Calcular</button>
    </form>

    <button type="button" id="copyButton">Copiar Resultado</button>

    <output id="result" role="status" aria-live="polite"></output>

    <hr />

    <script>
      "use strict";

      // ======= UTILITÁRIOS (KISS + SRP) =======
      const isPositive = (n) => Number(n) > 0 && isFinite(Number(n));

      // Holliday–Segar (mL/24h)
      function calcManutencao24h(peso) {
        if (peso <= 10) return peso * 100;
        if (peso <= 20) return 1000 + (peso - 10) * 50;
        return 1500 + (peso - 20) * 20;
      }

      function arredondaMl(v) {
        return Math.round(v);
      }

      function fmtMl(v) {
        const r = arredondaMl(v);
        return `(${r}) ${v.toFixed(2)} mL`;
      }

      function calcInsulinaHora(peso, taxa = 0.1) {
        // 0,05–0,1 U/kg/h (sem bolus). Mantemos 0,1 como cálculo principal, exibindo a faixa.
        return peso * taxa;
      }

      function calcOsmoterapiaDoses(peso) {
        // Valores exibidos como referência rápida na ficha ASCII
        const salina3Min = peso * 3; // mL de NaCl 3%
        const salina3Max = peso * 5;
        const manitolGrMin = peso * 0.5; // g
        const manitolGrMax = peso * 1.0; // g
        return { salina3Min, salina3Max, manitolGrMin, manitolGrMax };
      }

      // ======= PRINCIPAL =======
      document.getElementById("calcButton").addEventListener("click", () => {
        try {
          const peso = parseFloat(document.getElementById("weight").value);
          const idade = document.getElementById("ageYears").value || "____";
          const choque = document.getElementById("shock").value;
          const deficitPerc = parseFloat(
            document.getElementById("dehydration").value,
          );
          const volInicialMlKg = parseFloat(
            document.getElementById("initialRate").value,
          );

          const out = document.getElementById("result");

          if (!isPositive(peso)) {
            out.textContent = "Peso inválido.";
            return;
          }

          // Cálculos centrais (DRY)
          const manut24 = calcManutencao24h(peso); // mL/24h
          const deficit = peso * (deficitPerc / 100) * 1000; // mL
          const total48 = manut24 * 2 + deficit; // mL
          const taxaHora = total48 / 48; // mL/h
          const volInicial = peso * volInicialMlKg; // mL na 1ª hora
          const bolusChoque = peso * 20; // mL (se choque)
          const insulinaHoraAlta = calcInsulinaHora(peso, 0.1); // U/h
          const insulinaHoraBaixa = calcInsulinaHora(peso, 0.05); // U/h
          const { salina3Min, salina3Max, manitolGrMin, manitolGrMax } =
            calcOsmoterapiaDoses(peso);

          // Montagem ASCII (sem PDF, sem impressão)
          const texto = `
=====================================================================
FICHA ASCII – CETOACIDOSE DIABÉTICA PEDIÁTRICA (CAD)
=====================================================================
Idade: ${idade} anos
Peso: ${peso.toFixed(1)} kg
Data/Hora: _____________________

SUSPEITA CLÍNICA
---------------------------------------------------------------------
[ ] poliúria  [ ] polidipsia  [ ] perda ponderal  [ ] vômitos
[ ] dor abdominal  [ ] respiração de Kussmaul  [ ] hálito cetônico
[ ] desidratação  [ ] alteração do sensório: _______________________

CONDUTA INICIAL (PRIMEIRA HORA)
---------------------------------------------------------------------
- Avaliar ABCDE e perfusão.
- Coletar gaso, eletrólitos, glicemia, ureia/creatinina, cetonas.
- Iniciar hidratação com SF 0,9% ${fmtMl(volInicial)} em 1 h. Cálculo feito com ((~${volInicialMlKg} mL/kg))
  Reavaliar perfusão e repetir 10–20 mL/kg/1 h se necessário.
${
  choque === "yes"
    ? `- Choque: bolus ${fmtMl(bolusChoque)} (20 mL/kg), reavaliar e repetir se necessário.`
    : `- Choque: ausente.`
}

CÁLCULOS DE LÍQUIDOS
---------------------------------------------------------------------
Manutenção 24 h (Holliday–Segar): ${fmtMl(manut24)}
Déficit (${deficitPerc}%):         ${fmtMl(deficit)}
Total 48 h:                        ${fmtMl(total48)}
Taxa horária alvo:                 ${fmtMl(taxaHora)}/h
* Repor déficit em 36–48 h, ajustando por Na⁺ corrigido e osmolalidade.

INSULINA IV (após 1–2 h de líquidos e K⁺ ≥ 3,3) – SEM BOLUS
---------------------------------------------------------------------
Regular 0,05–0,1 U/kg/h
Faixa de dose: ${insulinaHoraBaixa.toFixed(1)} a ${insulinaHoraAlta
            .toFixed(1)
            .padStart(4, " ")} U/h
Meta: queda da glicose 50–100 mg/dL/h e fechamento da cetose.
Quando glicose ≤ 250–300 mg/dL → ADICIONAR dextrose (SG 5–10%) mantendo a insulina.

POTÁSSIO (APÓS LABORATÓRIO)
---------------------------------------------------------------------
K⁺ sérico: ______ mEq/L   Diurese: [ ] sim  [ ] não
Conduta:
  - Se < 3,3: adiar insulina e repor até ≥ 3,3.
  - Se 3,3–5,5 e com diurese: iniciar 40 mEq/L (20 KCl + 20 K-fosfato/acetato).
  - Se > 5,5: não repor; monitorar seriado e reavaliar.

MONITORIZAÇÃO
---------------------------------------------------------------------
- Glicemia: 1/1 h
- Gaso/eletrólitos/ureia: 2–4/4 h
- Estado neurológico e sinais vitais: 1/1 h
- Balanço hídrico e diurese horária (anotar volumes)

EDEMA CEREBRAL – TRATAR IMEDIATAMENTE SE SUSPEITO (NÃO ESPERAR TC)
---------------------------------------------------------------------
Sinais: cefaleia, vômitos, rebaixamento do sensório, pupilas alteradas,
bradicardia/hipertensão, convulsões.
Conduta:
  - Salina hipertônica 3%: ${fmtMl(salina3Min)} a ${fmtMl(
    salina3Max,
  )} (3–5 mL/kg) IV em 10–15 min
    ou
  - Manitol: ${manitolGrMin.toFixed(1)} a ${manitolGrMax.toFixed(
    1,
  )} g (0,5–1 g/kg) IV em 10–15 min
  - Reduzir velocidade de líquidos (~ −1/3), elevar cabeceira, evitar hipocapnia.

CRITÉRIOS DE RESOLUÇÃO E TRANSIÇÃO
---------------------------------------------------------------------
Clínico: estável, alerta, tolerando VO.
Laboratorial: HCO3- ≥ 15, pH > 7,30, anion gap fechado, cetonemia ↓.
Transição: aplicar insulina SC 30–60 min antes de parar infusão IV.

=====================================================================
ANOTAÇÕES RÁPIDAS
---------------------------------------------------------------------
Glicemias (horárias): __ __ __ __ __ __ __ __ __ __
Na: ____  K: ____  Cl: ____  HCO3-: ____  Ureia/Cr: ____/____
Observações: _________________________________________________

---------------------------------------------------------------------
PEARLS & PITFALLS
---------------------------------------------------------------------
- Corrija devagar: quedas rápidas de osmolalidade → edema cerebral.
- K⁺ comanda o início da insulina: se K⁺ < 3,3, segure insulina e reponha K⁺.
- Sem bolus de insulina; o objetivo é resolver a cetose/acidose.
- Na⁺ corrigido deve subir enquanto a glicose cai; se não, revise a tonicidade.

---------------------------------------------------------------------
TL;DR
---------------------------------------------------------------------
- 1ª hora: SF 0,9% ${volInicialMlKg} mL/kg em 1 h; repetir 10–20 mL/kg/1 h conforme perfusão.
- Insulina IV 0,05–0,1 U/kg/h **sem bolus** após 1–2 h de líquidos e K⁺ ≥ 3,3.
- Dextrose quando glicose ≤ 250–300 mg/dL, mantendo a insulina.
- Monitorar glicemia 1/1 h; eletrólitos/gaso 2–4/4 h; vigiar neurologia.
- Edema cerebral: Salina 3% 3–5 mL/kg ou Manitol 0,5–1 g/kg imediatamente.
`;

          out.textContent = texto;
        } catch (err) {
          console.error(err);
          document.getElementById("result").textContent =
            "Erro inesperado. Verifique os dados.";
        }
      });

      // ======= COPIAR =======
      document
        .getElementById("copyButton")
        .addEventListener("click", async () => {
          const texto = document.getElementById("result").textContent.trim();
          if (!texto) return;
          try {
            await navigator.clipboard.writeText(texto);
            alert("Resultado copiado para a área de transferência!");
          } catch {
            alert("Falha ao copiar.");
          }
        });

      // ======= TESTES BÁSICOS (sanidade) =======
      (function runTests() {
        console.assert(calcManutencao24h(10) === 1000, "manut 10 kg");
        console.assert(calcManutencao24h(15) === 1250, "manut 15 kg");
        console.assert(calcManutencao24h(25) === 1700, "manut 25 kg");
        console.log("Testes básicos OK");
      })();
    </script>
  </body>
</html>
