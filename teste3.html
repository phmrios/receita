<!doctype html>
<html lang="pt-BR">
  <head>
    <link rel="stylesheet" href="style.css" />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Calculadora de Reidrata√ß√£o Pedi√°trica v3.0</title>

    <style>
      :root {
        color-scheme: light dark;
        --fg: #000;
        --bg: #fff;
        --accent: #004080;
        --border: #ccc;
        --focus: #ffbf00;
      }

      body {
        font-family: monospace, Consolas, "Courier New", monospace;
        background: var(--bg);
        color: var(--fg);
        line-height: 1.6;
        margin: 1rem auto;
        max-width: 740px;
        padding: 1rem;
      }

      label {
        display: block;
        margin-top: 1rem;
        font-weight: 700;
      }

      input,
      select,
      button {
        width: 100%;
        padding: 0.6rem;
        border: 2px solid var(--border);
        border-radius: 4px;
        font-size: 1rem;
      }

      button {
        background: var(--accent);
        color: #fff;
        font-weight: 700;
        cursor: pointer;
        margin-top: 1rem;
      }

      button:focus,
      input:focus,
      select:focus {
        outline: 3px solid var(--focus);
        outline-offset: 2px;
      }

      pre,
      output {
        display: block;
        margin-top: 1.5rem;
        padding: 1rem;
        border: 2px solid var(--border);
        border-radius: 4px;
        background: #f9f9f9;
        color: #000;
        white-space: pre-wrap;
      }

      hr {
        margin: 2rem 0;
      }

      @media print {
        body * {
          display: none !important;
        }
        #soroSection,
        #soroText {
          display: block !important;
          border: none;
          background: #fff;
          color: #000;
        }
      }
    </style>
  </head>

  <body>
    <nav class="navbar">
      <ul>
        <li><a href="index.html">In√≠cio</a></li>
        <li>
          <a href="teste3.html" class="active">Hidrata√ß√£o OMS / Nelson</a>
        </li>
        <li><a href="pals.html">Ficha PALS</a></li>
      </ul>
    </nav>

    <h1>Calculadora de Reidrata√ß√£o Pedi√°trica v3.0</h1>

    <form id="calcForm">
      <label for="method">M√©todo de c√°lculo</label>
      <select id="method" name="method" aria-required="true">
        <option value="oms">OMS / Minist√©rio da Sa√∫de</option>
        <option value="nelson">Nelson (d√©ficit + manuten√ß√£o)</option>
      </select>

      <label for="weight">Peso (kg)</label>
      <input
        id="weight"
        name="weight"
        type="number"
        min="1"
        step="0.1"
        required
        aria-required="true"
      />

      <label for="age">Idade (meses)</label>
      <input
        id="age"
        name="age"
        type="number"
        min="0"
        step="1"
        placeholder="opcional"
        aria-describedby="ageHelp"
      />
      <small id="ageHelp"
        >Usado apenas para ajustar o tempo de infus√£o no Plano C (OMS).</small
      >

      <label for="status">Estado cl√≠nico</label>
      <select id="status" name="status" aria-required="true">
        <option value="none">Sem desidrata√ß√£o</option>
        <option value="mild">Leve</option>
        <option value="moderate">Moderada</option>
        <option value="severe">Grave</option>
      </select>

      <label for="shock">Choque?</label>
      <select id="shock" name="shock">
        <option value="no">N√£o</option>
        <option value="yes">Sim</option>
      </select>

      <button type="button" id="calcButton">Calcular</button>
    </form>

    <button type="button" id="copyButton">üìã Copiar Resultado</button>

    <output id="result" role="status" aria-live="polite"></output>

    <hr />

    <section id="soroSection">
      <button type="button" id="printButton">üñ®Ô∏è Imprimir Receita</button>

      <h2>Receita de Soro Caseiro (SRO)</h2>

      <pre id="soroText">
==============================
 COMO FAZER SORO CASEIRO
==============================

üì¶ INGREDIENTES:
- 1 litro de √°gua limpa (filtrada e fervida)
- 1 colher de ch√° rasa de sal
- 2 colheres de sopa rasas de a√ß√∫car

ü™£ MODO DE PREPARO:
1. Ferva a √°gua e deixe esfriar.
2. Misture sal e a√ß√∫car at√© dissolver completamente.
3. O gosto deve lembrar uma l√°grima ‚Äî nem muito doce nem muito salgado.

ü•§ COMO USAR:
- Crian√ßas: 1 colher de sopa a cada 1‚Äì2 minutos.
- Adultos: copos pequenos v√°rias vezes por hora.
- Continue at√© parar diarreia e v√¥mitos.

‚ö†Ô∏è CUIDADO:
- Fa√ßa soro novo a cada 24 h.
- Se houver sede intensa, fraqueza ou recusa de l√≠quidos, procure atendimento.
==============================
      </pre>
    </section>

    <script>
      "use strict";

      // ======= UTILIT√ÅRIOS =======
      const fmtMl = (v) => `(${Math.round(v)}) ${v.toFixed(2)} mL`;
      const isPositive = (n) => Number(n) > 0 && isFinite(Number(n));

      const calcManutencao = (peso) => {
        if (peso <= 10) return peso * 100;
        if (peso <= 20) return 1000 + (peso - 10) * 50;
        return 1500 + (peso - 20) * 20;
      };

      const calcTaxaHorario = (peso) => {
        if (peso <= 10) return peso * 4;
        if (peso <= 20) return 40 + (peso - 10) * 2;
        return 60 + (peso - 20);
      };

      // ======= OMS / MS =======
      function calcularOMS(peso, status, idadeMeses) {
        switch (status) {
          case "none":
            return `Plano A - Sem desidrata√ß√£o
Reidratar em casa com SRO ap√≥s cada evacua√ß√£o:
<2a: 50‚Äì100 mL | ‚â•2a: 100‚Äì200 mL
Manter alimenta√ß√£o e zinco por 10‚Äì14 dias.`;
          case "mild":
          case "moderate": {
            const total = peso * 75;
            const taxaHora = total / 4;
            return `Plano B - Alguma desidrata√ß√£o
SRO 75 mL/kg em 4 h
‚Üí Total: ${fmtMl(total)} em 4 h
‚Üí Taxa m√©dia: ${fmtMl(taxaHora)}/h`;
          }
          case "severe": {
            const menor12 = idadeMeses && idadeMeses < 12;
            const fase1 = peso * 30;
            const fase2 = peso * 70;
            const t1 = menor12 ? 1 : 0.5;
            const t2 = menor12 ? 5 : 2.5;
            const total = fase1 + fase2;
            const taxa1 = fase1 / t1;
            const taxa2 = fase2 / t2;
            return `Plano C - Desidrata√ß√£o grave
Ringer Lactato (ou SF 0,9%)
‚Üí Total: ${fmtMl(total)} (100 mL/kg)
   Fase 1: ${fmtMl(fase1)} em ${t1} h ‚Äî Taxa ‚âà ${fmtMl(taxa1)}/h
   Fase 2: ${fmtMl(fase2)} em ${t2} h ‚Äî Taxa ‚âà ${fmtMl(taxa2)}/h
Iniciar SRO 5 mL/kg/h assim que poss√≠vel.`;
          }
          default:
            return "Selecione o estado cl√≠nico.";
        }
      }

      // ======= NELSON =======
      const getPercent = (s) => ({ mild: 5, moderate: 8, severe: 10 })[s] || 0;

      function calcularNelson(peso, status, choque) {
        const perc = getPercent(status);
        if (perc === 0)
          return "Sem desidrata√ß√£o: apenas manuten√ß√£o e alimenta√ß√£o.";

        const deficit = peso * perc * 10;
        const manut = calcManutencao(peso);
        const fase1 = deficit * 0.5;
        const fase2 = deficit * 0.5;
        const taxa1 = fase1 / 8;
        const taxa2 = fase2 / 16;
        const total = deficit + manut;

        let texto = "";
        if (choque === "yes") {
          const bolus = peso * 20;
          texto += `Choque presente:
‚Üí Bolus inicial: ${fmtMl(bolus)} (20 mL/kg)
Reavaliar perfus√£o; repetir se necess√°rio.\n\n`;
        }

        texto += `Nelson - D√©ficit + Manuten√ß√£o
Estimativa de desidrata√ß√£o: ${perc}%
D√©ficit: ${fmtMl(deficit)} (50% em 8 h, 50% em 16 h)
  Fase 1: ${fmtMl(fase1)} em 8 h ‚Äî Taxa ‚âà ${fmtMl(taxa1)}/h
  Fase 2: ${fmtMl(fase2)} em 16 h ‚Äî Taxa ‚âà ${fmtMl(taxa2)}/h
Manuten√ß√£o 24 h: ${fmtMl(manut)}
Total 24 h (d√©ficit + manuten√ß√£o): ${fmtMl(total)}
Iniciar SRO assim que poss√≠vel e ajustar conforme resposta cl√≠nica.`;
        return texto;
      }

      // ======= PRINCIPAL =======
      document.getElementById("calcButton").addEventListener("click", () => {
        try {
          const metodo = document.getElementById("method").value;
          const peso = parseFloat(document.getElementById("weight").value);
          const status = document.getElementById("status").value;
          const idade = parseFloat(document.getElementById("age").value);
          const choque = document.getElementById("shock").value;
          const res = document.getElementById("result");

          if (!isPositive(peso)) {
            res.textContent = "Peso inv√°lido.";
            return;
          }

          let textoPrincipal =
            metodo === "oms"
              ? calcularOMS(peso, status, idade)
              : calcularNelson(peso, status, choque);

          const manutTotal = calcManutencao(peso);
          const taxaHr = calcTaxaHorario(peso);

          const blocoManut = `
=== MANUTEN√á√ÉO BASAL (Holliday‚ÄìSegar) ===
Total 24 h: ${fmtMl(manutTotal)}
Taxa hor√°ria (4-2-1): ${fmtMl(taxaHr)}/h
Nota: o c√°lculo de manuten√ß√£o √© apenas refer√™ncia para avalia√ß√£o global da hidrata√ß√£o ‚Äî n√£o substitui o plano terap√™utico selecionado.
`;

          res.textContent = `=== RESULTADO PRINCIPAL ===
${textoPrincipal}

${blocoManut}`;
        } catch (err) {
          console.error(err);
          document.getElementById("result").textContent =
            "Erro inesperado. Verifique os dados.";
        }
      });

      // ======= COPIAR =======
      document
        .getElementById("copyButton")
        .addEventListener("click", async () => {
          const texto = document.getElementById("result").textContent.trim();
          if (!texto) return;
          try {
            await navigator.clipboard.writeText(texto);
            alert("Resultado copiado para a √°rea de transfer√™ncia!");
          } catch {
            alert("Falha ao copiar.");
          }
        });

      // ======= IMPRESS√ÉO =======
      document
        .getElementById("printButton")
        .addEventListener("click", () => window.print());

      // ======= TESTES =======
      (function runTests() {
        console.assert(calcManutencao(10) === 1000, "manut 10kg");
        console.assert(calcManutencao(15) === 1250, "manut 15kg");
        console.assert(getPercent("mild") === 5, "percent mild");
        console.assert(getPercent("severe") === 10, "percent severe");
        console.log("Testes b√°sicos OK");
      })();
    </script>
  </body>
</html>
